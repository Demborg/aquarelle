<!DOCTYPE html>
<html>
  <style>
    body {
      margin: 0px;
    }
    canvas {
      width: 100%;
    }
  </style>
  <script>
    const POLYGON = [[300, 300], [700, 300], [700, 700], [300, 700]]

    const add = (a, b) => {
        return [a[0] + b[0], a[1] + b[1]]
    }
    
    const scale = (v, s) => {
        return [v[0] * s, v[1] * s]
    }

    const norm = (vec) => {
        return Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1])
    } 

    const randomVector = (length) => {
        const theta = 2 * Math.PI * Math.random()
        const rho = Math.sqrt(-2 * Math.log(1 - Math.random()))
        return scale([Math.cos(theta), Math.sin(theta)], rho * length)
    };

    const drawPolygon = (ctx, points) => {
        ctx.beginPath()
        ctx.moveTo(points[0][0], points[0][1])
        points.forEach(element => {
            ctx.lineTo(element[0], element[1])
        });
        ctx.closePath()
        ctx.fill()
    }

    const randomizePolygon = (points, scale) => {
        return points.map(p => add(p, randomVector(scale)))
    }

    const subdivide = (points) => {
        return Array.from({length: points.length * 2}, (_, x) => {
            const i = Math.floor((x + 1) / 2) % points.length
            const j = Math.round((x + 1) / 2) % points.length
            return scale(add(points[i], points[j]), 0.5)
        })
    }

    const circularize = (points, center, s) => {
        return points.map(p => {
            const diff = add(p, scale(center, -1))
            return add(
                center,
                scale(diff, s/norm(diff))
            )
        })
    }

    const randomDeform = (points, scale) => {
        points = subdivide(points)
        return randomizePolygon(points, scale)
    }

    const fractalRandomDeform = (points, iterations, scale) => {
        for (let i = 0; i < iterations; i++) {
            points = randomDeform(points, scale / Math.pow(2, i))
        }
        return points
    }

    window.onload = () => {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const base1 = fractalRandomDeform(
            circularize(subdivide(POLYGON), add([500, 500], randomVector(100)), Math.random() * 200 + 100),
            3, 40
        )
        const base2 = fractalRandomDeform(
            circularize(subdivide(POLYGON), add([500, 500], randomVector(100)), Math.random() * 200 + 100),
            3, 40
        )
        for (let i = 0; i < 100; i++) {
            ctx.fillStyle = "rgba(255,0,0,0.01)"
            shape = fractalRandomDeform(base1, 2, 40)
            drawPolygon(ctx, shape)
            ctx.fillStyle = "rgba(0,0,255,0.01)"
            shape = fractalRandomDeform(base2, 2, 40)
            drawPolygon(ctx, shape)
        }
    };
  </script>
  <canvas id="canvas" width="1000" , height="1000"></canvas>
</html>